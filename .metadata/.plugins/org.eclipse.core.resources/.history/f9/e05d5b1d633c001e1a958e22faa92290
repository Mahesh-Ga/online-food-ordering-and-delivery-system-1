package com.onlinefood.service;

import javax.transaction.Transactional;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.onlinefood.custom_exceptions.ApiException;
import com.onlinefood.custom_exceptions.ResourceNotFoundException;
import com.onlinefood.dao.AddressDao;
import com.onlinefood.dao.CustomerDao;
import com.onlinefood.dto.AddCustomerAddressDTO;
import com.onlinefood.dto.AddCustomerDTO;
import com.onlinefood.entities.Address;
import com.onlinefood.entities.Customer;


@Service
@Transactional
public class CustomerServiceImpl implements CustomerService{
	
	@Autowired
	private ModelMapper mapper;
	
	@Autowired
	private CustomerDao customerDao;
	
	@Autowired
	private AddressDao addressDao;
	
	@Override
	public AddCustomerDTO addNewCustomer(AddCustomerDTO cDto) {
		if (cDto.getConfirmPassword().equals(cDto.getPassword())) {
			Customer customer = mapper.map(cDto, Customer.class);
			Customer persistentCustomer = customerDao.save(customer);
			return mapper.map(persistentCustomer, AddCustomerDTO.class);
		} else
			throw new ApiException("Passwords don't match!!!!!");
	}
	
	@Override
	public void addAddressToCustomer(Long customerId, AddCustomerAddressDTO address) {
		  Customer customer = customerDao.findById(customerId).orElseThrow(()->new ResourceNotFoundException("Invalid Customer Id !!!!"));
		  Address addr = mapper.map(address, Address.class);
		  customer.addAddress(address);
	      addressDao.save(address);	
	}
	
}
